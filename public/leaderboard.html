<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConeFlip Leaderboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .leaderboard-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 10px 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
        }

        .leaderboard-container h2 {
            font-size: 18px;
            text-align: center;
            margin-bottom: 10px;
            color: #94B658;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        th, td {
            padding: 6px 8px;
            text-align: left;
            font-size: 14px;
        }

        th {
            border-bottom: 1px solid #555;
            font-weight: normal;
            color: #94B658;
        }

        tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.1);
        }

        .top-player {
            background: rgba(255, 215, 0, 0.2);
        }

        .golden-cone {
            width: 16px;
            height: 16px;
            vertical-align: middle;
            margin-right: 6px;
        }

        .placeholder-row {
            color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 600px) {
            .leaderboard-container {
                width: 200px;
                top: 10px;
                right: 10px;
            }

            .leaderboard-container h2 {
                font-size: 16px;
            }

            th, td {
                padding: 4px 6px;
                font-size: 12px;
            }

            .golden-cone {
                width: 14px;
                height: 14px;
                margin-right: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="leaderboard-container">
        <h2>Coneflip Leaderboard</h2>
        <table id="leaderboard-table">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Ws</th>
                    <th>Ls</th>
                    <th>WR (%)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <img id="golden-cone-icon" src="skins/cone_gold.png" alt="Golden Cone" style="display: none;">
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        function renderLeaderboard(data) {
            const tableBody = document.querySelector('#leaderboard-table tbody');
            tableBody.innerHTML = '';

            if (!data || !data.length) {
                data = [];
            }

            const topPlayers = data.slice(0, 5);

            topPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                if (index === 0) {
                    row.classList.add('top-player');
                }

                const nameCell = document.createElement('td');
                if (index === 0) {
                    const coneIcon = document.getElementById('golden-cone-icon').cloneNode();
                    coneIcon.style.display = 'inline';
                    coneIcon.classList.add('golden-cone');
                    nameCell.appendChild(coneIcon);
                }
                const nameText = document.createElement('span');
                nameText.textContent = player.name || '-';
                nameCell.appendChild(nameText);
                row.appendChild(nameCell);

                const winsCell = document.createElement('td');
                winsCell.textContent = player.wins || '-';
                row.appendChild(winsCell);

                const lossesCell = document.createElement('td');
                lossesCell.textContent = player.fails || '-';
                row.appendChild(lossesCell);

                const winrateCell = document.createElement('td');
                winrateCell.textContent = player.winrate || '-';
                row.appendChild(winrateCell);

                tableBody.appendChild(row);
            });

            const placeholdersNeeded = 5 - topPlayers.length;
            for (let i = 0; i < placeholdersNeeded; i++) {
                const placeholderRow = document.createElement('tr');
                placeholderRow.classList.add('placeholder-row');

                for (let j = 0; j < 4; j++) {
                    const placeholderCell = document.createElement('td');
                    placeholderCell.textContent = '-';
                    placeholderRow.appendChild(placeholderCell);
                }

                tableBody.appendChild(placeholderRow);
            }
        }

        async function fetchLeaderboard() {
            try {
                const response = await fetch('/api/leaderboard');
                if (!response.ok) throw new Error('Failed to fetch leaderboard');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                return null;
            }
        }

        async function loadLeaderboard() {
            const data = await fetchLeaderboard();
            if (data && data.length) {
                renderLeaderboard(data);
            } else {
                renderLeaderboard([]);
            }
        }

        socket.on('leaderboard', data => {
            loadLeaderboard();
            if (data && data.length) {
                renderLeaderboard(data);
            } else {
                console.error('Received invalid leaderboard data via socket:', data);
            }
        });

        loadLeaderboard();
    </script>
</body>
</html>
